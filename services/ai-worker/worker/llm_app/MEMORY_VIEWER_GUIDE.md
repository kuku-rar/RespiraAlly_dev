# è¨˜æ†¶è³‡æ–™ç®¡ç†å·¥å…· - ä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½èªªæ˜

é€™å€‹å·¥å…·ç”¨æ–¼æŸ¥çœ‹å’Œç®¡ç† Beloved Grandson ç³»çµ±ä¸­çš„ç”¨æˆ¶è³‡æ–™ï¼š
- **Milvus**: ç”¨æˆ¶é•·æœŸè¨˜æ†¶ (user_memory collection)
- **Redis**: æœƒè©±è³‡æ–™ã€éŸ³é »ç·©è¡ã€è­¦å ±ç­‰

## ğŸš€ æ­£ç¢ºä½¿ç”¨æ–¹å¼

### æ–¹æ¡ˆ 1: åœ¨ Docker å®¹å™¨å…§é‹è¡Œ (æ¨è–¦)

```bash
# 1. ç¢ºä¿æ‰€æœ‰æœå‹™é‹è¡Œ
docker-compose -f docker-compose.dev.yml up -d

# 2. é€²å…¥ ai-worker å®¹å™¨
docker-compose -f docker-compose.dev.yml exec ai-worker bash

# 3. é‹è¡Œå·¥å…·
python worker/llm_app/view_memory_data.py
```

### æ–¹æ¡ˆ 2: æœ¬åœ°é‹è¡Œ (éœ€è¦è¨­å®š)

å¦‚æœè¦åœ¨æœ¬åœ°é‹è¡Œï¼Œéœ€è¦è¨­å®šç’°å¢ƒè®Šæ•¸ï¼š

```bash
# è¨­å®šé€£æ¥è³‡è¨Š
export MILVUS_URI="http://localhost:19530"
export REDIS_URL="redis://localhost:6379/0"

# é‹è¡Œå·¥å…·
python view_memory_data.py
```

## ğŸ”§ æ•…éšœæ’é™¤

### é€£æ¥å•é¡Œè¨ºæ–·

1. **æª¢æŸ¥æœå‹™ç‹€æ…‹**:
   ```bash
   docker-compose -f docker-compose.dev.yml ps
   ```

2. **æª¢æŸ¥ç¶²è·¯é€£æ¥**:
   ```bash
   # æª¢æŸ¥ Milvus
   curl http://localhost:19530
   
   # æª¢æŸ¥ Redis
   redis-cli ping
   ```

3. **æŸ¥çœ‹æ—¥èªŒ**:
   ```bash
   docker-compose -f docker-compose.dev.yml logs milvus
   docker-compose -f docker-compose.dev.yml logs redis
   ```

### å¸¸è¦‹éŒ¯èª¤è§£æ±º

| éŒ¯èª¤ | åŸå›  | è§£æ±ºæ–¹æ¡ˆ |
|------|------|----------|
| `Fail connecting to server on milvus:19530` | ä¸åœ¨ Docker ç¶²è·¯å…§ | ä½¿ç”¨å®¹å™¨å…§é‹è¡Œ |
| `Error 10061 connecting to localhost:6379` | Redis æœªå•Ÿå‹• | `docker-compose up -d redis` |
| `Collection user_memory not found` | è³‡æ–™åº«æœªåˆå§‹åŒ– | å…ˆé‹è¡Œä¸€æ¬¡å°è©±ç”¢ç”Ÿè³‡æ–™ |

## ğŸ® å·¥å…·åŠŸèƒ½

### ä¸»é¸å–®é¸é …

1. **ç³»çµ±æ¦‚è¦½**: æŸ¥çœ‹æ•´é«”è³‡æ–™çµ±è¨ˆ
2. **ç”¨æˆ¶ç®¡ç†**: æŸ¥çœ‹/åˆªé™¤ç‰¹å®šç”¨æˆ¶çš„æ‰€æœ‰è³‡æ–™
3. **è³‡æ–™ç€è¦½**: åˆ†åˆ¥ç€è¦½ Milvus æˆ– Redis è³‡æ–™
4. **é€£æ¥æ¸¬è©¦**: æ¸¬è©¦ä¸¦é‡æ–°é€£æ¥æœå‹™

### è³‡æ–™é¡å‹èªªæ˜

#### Milvus (user_memory)
- `id`: è‡ªå‹•ç”Ÿæˆçš„ä¸»éµ
- `user_id`: ç”¨æˆ¶è­˜åˆ¥ç¢¼
- `updated_at`: æ›´æ–°æ™‚é–“æˆ³ (æ¯«ç§’)
- `text`: è¨˜æ†¶æ–‡æœ¬å…§å®¹
- `embedding`: å‘é‡è¡¨ç¤º (1536ç¶­)

#### Redis éµå€¼æ¨¡å¼
- `session:{user_id}:*`: æœƒè©±ç›¸é—œè³‡æ–™
  - `state`: æœƒè©±ç‹€æ…‹
  - `history`: å°è©±æ­·å²
  - `summary:text`: æ‘˜è¦æ–‡æœ¬
  - `summary:rounds`: æ‘˜è¦è¼ªæ•¸
  - `alerts`: è­¦å ±è¨˜éŒ„

- `audio:{user_id}:*`: éŸ³é »ç›¸é—œè³‡æ–™
  - `buf`: éŸ³é »ç·©è¡
  - `result`: è™•ç†çµæœ

- `processed:{user_id}:*`: å·²è™•ç†è«‹æ±‚è¨˜éŒ„
- `lock:audio:*`: éŸ³é »è™•ç†é–
- `alerts:stream`: ç³»çµ±è­¦å ±æµ

## âš ï¸ å®‰å…¨æ³¨æ„äº‹é …

1. **åˆªé™¤ç¢ºèª**: åˆªé™¤è³‡æ–™éœ€è¦è¼¸å…¥ 'DELETE' ç¢ºèª
2. **å‚™ä»½å»ºè­°**: é‡è¦è³‡æ–™å»ºè­°å…ˆå‚™ä»½
3. **æ¬Šé™æ§åˆ¶**: åƒ…é™é–‹ç™¼å’Œé‹ç¶­äººå“¡ä½¿ç”¨
4. **æ—¥èªŒè¨˜éŒ„**: æ‰€æœ‰æ“ä½œéƒ½æœƒè¨˜éŒ„åœ¨çµ‚ç«¯

## ğŸ“ æ”¯æ´

å¦‚æœé‡åˆ°å•é¡Œï¼š
1. å…ˆä½¿ç”¨å·¥å…·å…§çš„ã€Œé€£æ¥æ¸¬è©¦ã€åŠŸèƒ½
2. æª¢æŸ¥ Docker å®¹å™¨ç‹€æ…‹
3. æŸ¥çœ‹ç›¸é—œæœå‹™æ—¥èªŒ
4. ç¢ºèªç’°å¢ƒè®Šæ•¸è¨­å®š

---

**é–‹ç™¼åœ˜éšŠ**: Beloved Grandson AI Team  
**æœ€å¾Œæ›´æ–°**: 2024
