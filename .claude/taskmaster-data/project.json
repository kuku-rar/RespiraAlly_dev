{
  "project_id": "respirally_v1_refactoring",
  "project_name": "RespiraAlly V1 - COPD Healthcare Platform (Refactoring Phase)",
  "version": "v1.0-refactor",
  "status": "refactoring",
  "created_at": "2025-11-03T04:26:00Z",
  "last_updated": "2025-11-03T04:26:00Z",

  "metadata": {
    "description": "å°èªèªéŸ³äº’å‹•çš„ COPD æ…¢æ€§ç—…å¥åº·ç®¡ç†å¹³å° - åŸºæ–¼ Linus å¯¦ç”¨ä¸»ç¾©åŸå‰‡é€²è¡Œé‡æ§‹",
    "project_phase": "Phase 2 Development + Refactoring",
    "domain": "Healthcare/AI/Chronic Disease Management",
    "tech_stack": {
      "backend": ["Python 3.11+", "Flask", "SQLAlchemy", "Flask-JWT-Extended", "Celery"],
      "frontend": ["React", "Vite", "Ant Design", "LINE LIFF"],
      "database": ["PostgreSQL", "Redis", "MinIO", "Milvus"],
      "messaging": ["RabbitMQ"],
      "ai_ml": ["OpenAI API", "STT Services", "TTS Services", "LangChain", "RAG"],
      "deployment": ["Docker", "Docker Compose", "Nginx"],
      "monitoring": []
    },
    "architecture_patterns": ["Microservices", "Domain-Driven Design (Pragmatic)", "Event-Driven (Message Queue)"],
    "refactoring_philosophy": "Linus Torvalds Pragmatic Approach - æ‹’çµ•éåº¦è¨­è¨ˆ",
    "documentation": {
      "prd": "docs/02_project_brief_and_prd.md",
      "architecture": "docs/05_architecture_and_design_document.md",
      "system_architecture": "docs/system_architecture.md",
      "api_spec": "docs/06_api_design_specification.md",
      "refactoring_plan": "docs/refactoring_plan.md",
      "linus_principles": "docs/linus-refactor-principle.md",
      "wbs_plan": "docs/16_wbs_development_plan.md"
    }
  },

  "project_status": {
    "phase_1_mvp": {
      "name": "æ ¸å¿ƒ MVP (Text-First)",
      "status": "completed",
      "completion_date": "2025-09-XX",
      "features": [
        "âœ… ç—…æ‚£ LIFF - å¥åº·æ—¥èªŒã€å•å·ã€ç´”æ–‡å­— AI å°è©±",
        "âœ… æ²»ç™‚å¸«å„€è¡¨æ¿ - ç—…æ‚£åˆ—è¡¨ã€æ•¸æ“šåœ–è¡¨ã€æ•´åˆå¼èŠå¤©å®¤",
        "âœ… å¾Œç«¯ API - æ ¸å¿ƒæ¥­å‹™é‚è¼¯ã€è³‡æ–™åº«ã€Redis å¿«å–",
        "âœ… AI Worker - æ–‡å­—ç‰ˆ LLM+RAG"
      ]
    },
    "phase_2_mvp": {
      "name": "å®Œæ•´ MVP (Voice-Enabled)",
      "status": "in_progress",
      "target_completion": "2025-12-XX",
      "features": [
        "ğŸ”„ ç—…æ‚£ LIFF - èªéŸ³è¼¸å…¥ (STT æ•´åˆ)",
        "ğŸ”„ AI Worker - å®Œæ•´ STT->LLM->TTS æµç¨‹",
        "ğŸ”„ ç—…æ‚£ LIFF - èªéŸ³å›è¦†æ’­æ”¾"
      ]
    },
    "refactoring_phase": {
      "name": "æŠ€è¡“å‚µå‹™æ¸…ç† (Refactoring)",
      "status": "planned",
      "priority": "high",
      "reason": "ç¨‹å¼ç¢¼è…çˆ›å¾µå…†ï¼šé‚è¼¯åˆ†æ•£ã€æ¸¬è©¦å›°é›£ã€è¤‡é›œåº¦å¢åŠ ",
      "core_goals": [
        "ğŸ¯ æ ¸å¿ƒç›®æ¨™ 1: å‰å¾Œç«¯åˆ°è³‡æ–™åº«è³‡è¨Šæµæš¢é€š",
        "ğŸ¯ æ ¸å¿ƒç›®æ¨™ 2: é”æˆ 100% æ¸¬è©¦è¦†è“‹ç‡"
      ],
      "objectives": [
        "å»ºç«‹å®Œæ•´çš„è³‡è¨Šæµæ•´åˆæ¸¬è©¦ï¼ˆFrontend â†’ API â†’ Database â†’ AI-Workerï¼‰",
        "é”æˆ 100% æ¸¬è©¦è¦†è“‹ç‡ï¼ˆå–®å…ƒæ¸¬è©¦ + æ•´åˆæ¸¬è©¦ + API å¥‘ç´„æ¸¬è©¦ + E2E æ¸¬è©¦ï¼‰",
        "åš´æ ¼éµå¾ª TDD ç´…-ç¶ -é‡æ§‹å¾ªç’°",
        "å»ºç«‹ API å¥‘ç´„æ¸¬è©¦å®‰å…¨ç¶²ï¼ˆNever Break APIsï¼‰",
        "åˆ†é›¢é ˜åŸŸæ¨¡å‹èˆ‡ SQLAlchemy æŒä¹…åŒ–å±¤",
        "é›†ä¸­åŒ–æ¥­å‹™é‚è¼¯åˆ°é ˜åŸŸç‰©ä»¶",
        "çµ±ä¸€ AI Pipeline è¨­è¨ˆä¸¦æ¸¬è©¦å®Œæ•´æµç¨‹"
      ]
    }
  },

  "timeline": {
    "phase_1_completed": "2025-09-XX",
    "phase_2_started": "2025-10-XX",
    "refactoring_started": "2025-11-03",
    "target_phase_2_complete": "2025-12-XX",
    "target_refactoring_complete": "2025-11-XX"
  },

  "refactoring_principles": {
    "philosophy": "Linus Torvalds Pragmatic Approach",
    "core_rules": [
      "è³‡æ–™çµæ§‹å„ªå…ˆ (Data Structures First) - åˆ†é›¢é ˜åŸŸæ¨¡å‹èˆ‡ ORM",
      "çµ•ä¸ç ´å£ API (Never Break APIs) - API å¥‘ç´„æ¸¬è©¦æ˜¯éµå¾‹",
      "é‚è¼¯é›†ä¸­ç®¡ç† (Logic in One Place) - æ¥­å‹™é‚è¼¯åªå­˜åœ¨ä¸€å€‹åœ°æ–¹",
      "æœ‰æ„ç¾©çš„æ¸¬è©¦ (Write Tests That Matter) - å–®å…ƒæ¸¬è©¦ + API å¥‘ç´„æ¸¬è©¦",
      "TDD ç´…-ç¶ -é‡æ§‹ (Red-Green-Refactor) - å¿…é ˆå…ˆçœ‹åˆ°æ¸¬è©¦å¤±æ•—"
    ],
    "anti_patterns_rejected": [
      "âŒ æ•™ç§‘æ›¸å¼æ´‹è”¥æ¶æ§‹ (Onion Architecture)",
      "âŒ å®Œæ•´ DDD å¯¦ç¾ (Full DDD)",
      "âŒ Gherkin BDD æª”æ¡ˆï¼ˆç„¡ PM ç¶­è­·æ‰¿è«¾ï¼‰",
      "âŒ éåº¦æŠ½è±¡èˆ‡éæ—©å„ªåŒ–"
    ],
    "what_we_take": [
      "âœ… DDD ç²¾è¯ï¼šé—œæ³¨é»åˆ†é›¢ã€é ˜åŸŸæ¨¡å‹éš”é›¢",
      "âœ… ç°¡å–®å¯¦ç”¨çš„åˆ†å±¤ï¼šé ˜åŸŸå±¤ã€æœå‹™å±¤ã€å€‰å„²å±¤",
      "âœ… æ¸¬è©¦é©…å‹•é–‹ç™¼çš„æ ¸å¿ƒå¾ªç’°"
    ]
  },

  "refactoring_plan": {
    "phase_0": {
      "name": "å»ºç«‹å®‰å…¨ç¶² (Safety Net)",
      "priority": "P0",
      "blocking": true,
      "description": "æ­¤æ­¥é©Ÿå®Œæˆå‰ï¼Œä¸å…è¨±ä»»ä½•é‡æ§‹",
      "tasks": [
        {
          "id": "0.1",
          "title": "ç·¨å¯« OpenAPI å¥‘ç´„è¦æ ¼ (æ‰€æœ‰ç¾æœ‰ API)",
          "status": "pending",
          "estimated_hours": 16,
          "owner": "Backend + API Spec Writer"
        },
        {
          "id": "0.2",
          "title": "å»ºç«‹ API å¥‘ç´„æ¸¬è©¦å¥—ä»¶ (pytest + HTTP)",
          "status": "pending",
          "estimated_hours": 24,
          "owner": "QA + Backend",
          "acceptance": "100% API è¦†è“‹ç‡"
        },
        {
          "id": "0.3",
          "title": "æ•´åˆ API æ¸¬è©¦åˆ° CI/CD",
          "status": "pending",
          "estimated_hours": 4,
          "owner": "DevOps"
        },
        {
          "id": "0.4",
          "title": "é©—è­‰å®‰å…¨ç¶²å®Œæ•´æ€§",
          "status": "pending",
          "estimated_hours": 4,
          "owner": "Tech Lead",
          "acceptance": "æ‰€æœ‰ API æ¸¬è©¦é€šé"
        }
      ],
      "total_hours": 48,
      "exit_criteria": "API å¥‘ç´„æ¸¬è©¦è¦†è“‹ç‡ = 100%ï¼Œæ‰€æœ‰æ¸¬è©¦é€šé"
    },
    "phase_1": {
      "name": "æ¸…ç† Web-App æ ¸å¿ƒ",
      "priority": "P0",
      "dependencies": ["phase_0"],
      "tasks": [
        {
          "id": "1.1",
          "title": "å»ºç«‹ç´”é ˜åŸŸç‰©ä»¶ (Patient, DailyMetric, Questionnaire)",
          "status": "pending",
          "estimated_hours": 16,
          "owner": "Backend",
          "description": "åœ¨ app/core/domain/ å»ºç«‹ä¸ä¾è³´ SQLAlchemy çš„ç´” Python é¡åˆ¥"
        },
        {
          "id": "1.2",
          "title": "å»ºç«‹ Repository å±¤ (ORM â†” é ˜åŸŸç‰©ä»¶è½‰æ›)",
          "status": "pending",
          "estimated_hours": 20,
          "owner": "Backend",
          "description": "å»ºç«‹ PatientRepository, DailyMetricRepository ç­‰"
        },
        {
          "id": "1.3",
          "title": "é‡æ§‹ patient_service (ä½¿ç”¨æ–°é ˜åŸŸç‰©ä»¶)",
          "status": "pending",
          "estimated_hours": 16,
          "owner": "Backend"
        },
        {
          "id": "1.4",
          "title": "å°‡æ¥­å‹™é‚è¼¯å…§èšåˆ°é ˜åŸŸç‰©ä»¶ (å¦‚ calculate_risk)",
          "status": "pending",
          "estimated_hours": 12,
          "owner": "Backend",
          "description": "patient.calculate_risk() è€Œé service ä¸­çš„å‡½å¼"
        },
        {
          "id": "1.5",
          "title": "ç‚ºæ‰€æœ‰æ¥­å‹™é‚è¼¯ç·¨å¯«å–®å…ƒæ¸¬è©¦ (TDD)",
          "status": "pending",
          "estimated_hours": 24,
          "owner": "Backend + QA",
          "acceptance": "å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ > 80%"
        },
        {
          "id": "1.6",
          "title": "é©—è­‰ API å¥‘ç´„æ¸¬è©¦å…¨éƒ¨é€šé",
          "status": "pending",
          "estimated_hours": 4,
          "owner": "Tech Lead",
          "acceptance": "é›¶ API ç ´å£"
        }
      ],
      "total_hours": 92,
      "exit_criteria": "é ˜åŸŸæ¨¡å‹èˆ‡ ORM åˆ†é›¢ï¼Œæ¥­å‹™é‚è¼¯å…§èšï¼ŒAPI é›¶ç ´å£ï¼Œæ¸¬è©¦è¦†è“‹ç‡ > 80%"
    },
    "phase_2": {
      "name": "æ¸…ç† AI-Worker",
      "priority": "P1",
      "dependencies": ["phase_1"],
      "tasks": [
        {
          "id": "2.1",
          "title": "çµ±ä¸€ AI Task Pipeline è¨­è¨ˆ (æ¶ˆé™¤ Text/Voice åˆ†æ”¯)",
          "status": "pending",
          "estimated_hours": 12,
          "owner": "AI/ML",
          "description": "ç”¨ç­–ç•¥æ¨¡å¼çµ±ä¸€ [STT] -> [LLM+RAG] -> [TTS]"
        },
        {
          "id": "2.2",
          "title": "é‡æ§‹ LLM+RAG é‚è¼¯",
          "status": "pending",
          "estimated_hours": 16,
          "owner": "AI/ML"
        },
        {
          "id": "2.3",
          "title": "é‡æ§‹ STT/TTS æ•´åˆ",
          "status": "pending",
          "estimated_hours": 12,
          "owner": "AI/ML"
        },
        {
          "id": "2.4",
          "title": "ç‚º AI Worker ç·¨å¯«å–®å…ƒæ¸¬è©¦",
          "status": "pending",
          "estimated_hours": 16,
          "owner": "AI/ML + QA"
        }
      ],
      "total_hours": 56,
      "exit_criteria": "AI Pipeline çµ±ä¸€ï¼Œç„¡ç‰¹æ®Šæƒ…æ³åˆ†æ”¯ï¼Œæ¸¬è©¦è¦†è“‹å……åˆ†"
    },
    "phase_3": {
      "name": "æŒçºŒæ”¹é€²",
      "priority": "P2",
      "dependencies": ["phase_2"],
      "tasks": [
        {
          "id": "3.1",
          "title": "ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥ (code-quality-specialist)",
          "status": "pending",
          "estimated_hours": 8,
          "owner": "Code Quality Agent"
        },
        {
          "id": "3.2",
          "title": "å®‰å…¨æ€§ç¨½æ ¸ (security-infrastructure-auditor)",
          "status": "pending",
          "estimated_hours": 8,
          "owner": "Security Agent"
        },
        {
          "id": "3.3",
          "title": "æ•ˆèƒ½å„ªåŒ– (å¦‚éœ€è¦)",
          "status": "pending",
          "estimated_hours": 16,
          "owner": "Backend + AI/ML"
        },
        {
          "id": "3.4",
          "title": "æ–‡æª”æ›´æ–° (documentation-specialist)",
          "status": "pending",
          "estimated_hours": 8,
          "owner": "Documentation Agent"
        }
      ],
      "total_hours": 40,
      "exit_criteria": "å“è³ªæŒ‡æ¨™é”æ¨™ï¼Œå®‰å…¨ç„¡æ¼æ´ï¼Œæ–‡æª”å®Œæ•´"
    }
  },

  "total_refactoring_effort": {
    "total_hours": 236,
    "completed_hours": 0,
    "progress_percentage": 0,
    "current_phase": "phase_0",
    "current_task": "æº–å‚™é–‹å§‹"
  },

  "taskmaster_config": {
    "suggestion_mode": "MEDIUM",
    "hub_coordination": "enabled",
    "parallel_execution": false,
    "coordination_strategy": "sequential_with_safety_checks",
    "human_confirmation_required": [
      "API contract changes",
      "Database schema migrations",
      "Architecture refactoring decisions",
      "Breaking changes (ä»»ä½•å¯èƒ½ç ´å£ API çš„æ”¹å‹•)"
    ]
  },

  "available_subagents": {
    "code-quality-specialist": {
      "emoji": "ğŸŸ¡",
      "trigger_phase": "phase_3",
      "responsibilities": ["Code review", "Refactoring suggestions", "Technical debt analysis"]
    },
    "test-automation-engineer": {
      "emoji": "ğŸŸ¢",
      "trigger_phase": "phase_0, phase_1, phase_2",
      "responsibilities": ["Unit tests", "API contract tests", "Test coverage"]
    },
    "security-infrastructure-auditor": {
      "emoji": "ğŸ”´",
      "trigger_phase": "phase_3",
      "responsibilities": ["Security audits", "Vulnerability scanning"]
    },
    "documentation-specialist": {
      "emoji": "ğŸ“",
      "trigger_phase": "phase_3",
      "responsibilities": ["API documentation", "Architecture docs update"]
    }
  },

  "success_metrics": {
    "core_goals": {
      "data_flow_integration": {
        "target": "100%",
        "current": "æœªæ¸¬é‡",
        "description": "å‰å¾Œç«¯åˆ°è³‡æ–™åº«è³‡è¨Šæµå®Œå…¨æš¢é€šï¼Œç„¡æ–·é»",
        "validation": [
          "Frontend â†’ API è³‡æ–™æµæ¸¬è©¦",
          "API â†’ Database è³‡æ–™æµæ¸¬è©¦",
          "Database â†’ API â†’ Frontend å®Œæ•´å¾ªç’°æ¸¬è©¦",
          "LIFF â†’ API â†’ RabbitMQ â†’ AI-Worker â†’ Response å®Œæ•´æµç¨‹æ¸¬è©¦",
          "éŒ¯èª¤è™•ç†åœ¨æ¯ä¸€å±¤éƒ½æ­£ç¢ºåŸ·è¡Œ"
        ]
      },
      "test_coverage_total": {
        "target": "100%",
        "current": "æœªçŸ¥",
        "description": "å…¨å°ˆæ¡ˆæ¸¬è©¦è¦†è“‹ç‡é” 100%ï¼ˆä¸æ˜¯ 80%ï¼‰",
        "breakdown": {
          "unit_tests": "100% æ¥­å‹™é‚è¼¯è¦†è“‹",
          "integration_tests": "100% æœå‹™æ•´åˆè¦†è“‹",
          "api_contract_tests": "100% API ç«¯é»è¦†è“‹",
          "e2e_tests": "100% é—œéµä½¿ç”¨è€…æµç¨‹è¦†è“‹"
        }
      }
    },
    "refactoring_goals": {
      "api_contract_coverage": {
        "target": "100%",
        "current": "0%",
        "description": "æ‰€æœ‰ç¾æœ‰ API éƒ½æœ‰å¥‘ç´„æ¸¬è©¦"
      },
      "unit_test_coverage": {
        "target": "100%",
        "current": "æœªçŸ¥",
        "description": "æ‰€æœ‰æ¥­å‹™é‚è¼¯çš„å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡ï¼ˆä¸æ˜¯ 80%ï¼‰"
      },
      "integration_test_coverage": {
        "target": "100%",
        "current": "0%",
        "description": "æ‰€æœ‰æœå‹™å±¤èˆ‡è³‡æ–™åº«å±¤çš„æ•´åˆæ¸¬è©¦"
      },
      "e2e_test_coverage": {
        "target": "100%",
        "current": "0%",
        "description": "æ‰€æœ‰é—œéµä½¿ç”¨è€…æµç¨‹çš„ç«¯åˆ°ç«¯æ¸¬è©¦"
      },
      "domain_model_separation": {
        "target": "100%",
        "current": "0%",
        "description": "é ˜åŸŸæ¨¡å‹èˆ‡ ORM å®Œå…¨åˆ†é›¢"
      },
      "code_complexity_reduction": {
        "target": "æ¸›å°‘ 30%",
        "current": "åŸºæº–æœªæ¸¬é‡",
        "description": "æ¸›å°‘æ¢ä»¶åˆ†æ”¯ã€æå–æ–¹æ³•ã€é™ä½åœˆè¤‡é›œåº¦"
      }
    },
    "business_metrics": {
      "api_response_time": {
        "target": "<500ms",
        "current": "æœªçŸ¥"
      },
      "daily_health_report_completion": {
        "target": ">70%",
        "current": "æœªçŸ¥"
      },
      "ai_interaction_frequency": {
        "target": ">3æ¬¡/é€±",
        "current": "æœªçŸ¥"
      }
    }
  },

  "risks": [
    {
      "id": "RISK-R001",
      "description": "é‡æ§‹éç¨‹ä¸­æ„å¤–ç ´å£ API å°è‡´å‰ç«¯/LIFF æ•…éšœ",
      "impact": "Critical",
      "probability": "Medium",
      "mitigation": "Phase 0 çš„ API å¥‘ç´„æ¸¬è©¦æ˜¯å¼·åˆ¶æ€§å®‰å…¨ç¶²",
      "owner": "Tech Lead"
    },
    {
      "id": "RISK-R002",
      "description": "é‡æ§‹æ™‚é–“éé•·ï¼Œå»¶èª¤ Phase 2 èªéŸ³åŠŸèƒ½é–‹ç™¼",
      "impact": "High",
      "probability": "Medium",
      "mitigation": "æ¡ç”¨æ¼¸é€²å¼é‡æ§‹ï¼ŒPhase 1 èˆ‡ Phase 2 å¯ä¸¦è¡Œ",
      "owner": "PM"
    },
    {
      "id": "RISK-R003",
      "description": "æ¸¬è©¦è¦†è“‹ç‡ä¸è¶³ï¼Œéš±è— Bug æœªè¢«ç™¼ç¾",
      "impact": "High",
      "probability": "Low",
      "mitigation": "TDD ç´€å¾‹ + ç¨‹å¼ç¢¼å¯©æŸ¥",
      "owner": "QA Lead"
    }
  ],

  "team": {
    "roles": [
      {
        "role": "Tech Lead",
        "owner": "Backend Lead",
        "responsibilities": ["é‡æ§‹è¨ˆåŠƒåŸ·è¡Œ", "æŠ€è¡“æ±ºç­–", "ç¨‹å¼ç¢¼å¯©æŸ¥"]
      },
      {
        "role": "Backend Developer",
        "owner": "Backend Team",
        "responsibilities": ["é ˜åŸŸæ¨¡å‹é‡æ§‹", "Repository å¯¦ç¾", "å–®å…ƒæ¸¬è©¦"]
      },
      {
        "role": "AI/ML Engineer",
        "owner": "AI Specialist",
        "responsibilities": ["AI Worker é‡æ§‹", "Pipeline çµ±ä¸€"]
      },
      {
        "role": "QA Engineer",
        "owner": "QA Team",
        "responsibilities": ["API å¥‘ç´„æ¸¬è©¦", "æ¸¬è©¦ç­–ç•¥", "è¦†è“‹ç‡ç›£æ§"]
      },
      {
        "role": "Frontend Developer",
        "owner": "Frontend Team",
        "responsibilities": ["ç¢ºä¿ API è®Šæ›´é€šçŸ¥", "æ•´åˆæ¸¬è©¦"]
      }
    ]
  },

  "reporting": {
    "daily_standup": {
      "enabled": true,
      "duration_minutes": 15,
      "focus": "é‡æ§‹é€²åº¦èˆ‡é˜»ç¤™"
    },
    "weekly_refactoring_report": {
      "enabled": true,
      "metrics": [
        "API å¥‘ç´„æ¸¬è©¦è¦†è“‹ç‡",
        "å–®å…ƒæ¸¬è©¦è¦†è“‹ç‡",
        "å·²é‡æ§‹æ¨¡çµ„æ•¸",
        "ç¨‹å¼ç¢¼å“è³ªæŒ‡æ¨™"
      ]
    }
  },

  "next_actions": [
    {
      "action": "å•Ÿå‹• Phase 0 - å»ºç«‹ API å¥‘ç´„è¦æ ¼",
      "priority": "P0",
      "description": "ä½¿ç”¨ OpenAPI/Swagger ç‚ºæ‰€æœ‰ç¾æœ‰ API ç«¯é»ç·¨å¯«è¦æ ¼",
      "owner": "Backend + API Spec Writer",
      "estimated_hours": 16,
      "blocking": "æ‰€æœ‰é‡æ§‹å·¥ä½œ"
    },
    {
      "action": "å»ºç«‹ API å¥‘ç´„æ¸¬è©¦å¥—ä»¶",
      "priority": "P0",
      "description": "ä½¿ç”¨ pytest ç›´æ¥é€é HTTP å‘¼å« API ç«¯é»é©—è­‰",
      "owner": "QA + Backend",
      "estimated_hours": 24,
      "dependencies": ["å•Ÿå‹• Phase 0"]
    }
  ]
}
